# æŒ‰è‚¡ç¥¨ç±»å‹ç­›é€‰è®­ç»ƒæŒ‡å—

## ğŸ¯ åŠŸèƒ½è¯´æ˜

ç°åœ¨æ‰€æœ‰è®­ç»ƒè„šæœ¬éƒ½æ”¯æŒæŒ‰è‚¡ç¥¨ç±»å‹ç­›é€‰ï¼Œå¯ä»¥åªè®­ç»ƒç‰¹å®šç±»å‹çš„è‚¡ç¥¨ï¼ˆå¦‚ä¸»æ¿ã€åˆ›ä¸šæ¿ã€ç§‘åˆ›æ¿ç­‰ï¼‰ã€‚

---

## ğŸ“‹ è‚¡ç¥¨ç±»å‹

æ ¹æ®`StockBasicInfo`è¡¨çš„`stock_type`å­—æ®µï¼Œå¸¸è§çš„è‚¡ç¥¨ç±»å‹åŒ…æ‹¬ï¼š

- **ä¸»æ¿** - æ²ªæ·±ä¸»æ¿è‚¡ç¥¨
- **åˆ›ä¸šæ¿** - åˆ›ä¸šæ¿è‚¡ç¥¨ï¼ˆ300å¼€å¤´ï¼‰
- **ç§‘åˆ›æ¿** - ç§‘åˆ›æ¿è‚¡ç¥¨ï¼ˆ688å¼€å¤´ï¼‰
- **ä¸­å°æ¿** - ä¸­å°æ¿è‚¡ç¥¨ï¼ˆå·²å¹¶å…¥ä¸»æ¿ï¼‰
- **åŒ—äº¤æ‰€** - åŒ—äº¤æ‰€è‚¡ç¥¨

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ•°æ®é¢„çƒ­

#### åªé¢„çƒ­ä¸»æ¿è‚¡ç¥¨

```bash
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume
```

#### åªé¢„çƒ­åˆ›ä¸šæ¿è‚¡ç¥¨

```bash
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type åˆ›ä¸šæ¿ \
    --workers 8 \
    --resume
```

#### åªé¢„çƒ­ç§‘åˆ›æ¿è‚¡ç¥¨

```bash
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ç§‘åˆ›æ¿ \
    --workers 8 \
    --resume
```

#### é¢„çƒ­æ‰€æœ‰ç±»å‹ï¼ˆé»˜è®¤ï¼‰

```bash
python scripts/prepare_training_data.py \
    --symbols all \
    --workers 8 \
    --resume
```

### 2. è®­ç»ƒé€šç”¨æ¨¡å‹

#### åªè®­ç»ƒä¸»æ¿è‚¡ç¥¨

```bash
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

#### åªè®­ç»ƒåˆ›ä¸šæ¿è‚¡ç¥¨

```bash
python scripts/train_universal_model.py \
    --stock-type åˆ›ä¸šæ¿ \
    --device cuda
```

#### è®­ç»ƒæ‰€æœ‰ç±»å‹ï¼ˆé»˜è®¤ï¼‰

```bash
python scripts/train_universal_model.py \
    --device cuda
```

### 3. æ‰¹é‡è®­ç»ƒç‹¬ç«‹æ¨¡å‹

#### åªè®­ç»ƒä¸»æ¿è‚¡ç¥¨

```bash
python scripts/batch_train_all_stocks.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 4 \
    --resume
```

#### åªè®­ç»ƒåˆ›ä¸šæ¿è‚¡ç¥¨

```bash
python scripts/batch_train_all_stocks.py \
    --symbols all \
    --stock-type åˆ›ä¸šæ¿ \
    --workers 4 \
    --resume
```

---

## ğŸ“Š è‚¡ç¥¨æ•°é‡å‚è€ƒ

| è‚¡ç¥¨ç±»å‹ | å¤§çº¦æ•°é‡ | è¯´æ˜ |
|---------|---------|------|
| ä¸»æ¿ | ~3000åª | æ²ªæ·±ä¸»æ¿ |
| åˆ›ä¸šæ¿ | ~1200åª | 300å¼€å¤´ |
| ç§‘åˆ›æ¿ | ~500åª | 688å¼€å¤´ |
| å…¨éƒ¨ | ~5000åª | æ‰€æœ‰æ´»è·ƒè‚¡ç¥¨ |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šåªå…³æ³¨ä¸»æ¿è‚¡ç¥¨

```bash
# 1. æ•°æ®é¢„çƒ­
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# 2. è®­ç»ƒé€šç”¨æ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

**ä¼˜åŠ¿ï¼š**
- æ•°æ®é‡é€‚ä¸­ï¼ˆ~3000åªï¼‰
- è®­ç»ƒæ—¶é—´çŸ­
- ä¸»æ¿è‚¡ç¥¨æ›´ç¨³å®š

### åœºæ™¯2ï¼šåˆ†ç±»å‹è®­ç»ƒå¤šä¸ªæ¨¡å‹

```bash
# è®­ç»ƒä¸»æ¿æ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --output-dir out/universal_model_mainboard \
    --device cuda

# è®­ç»ƒåˆ›ä¸šæ¿æ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type åˆ›ä¸šæ¿ \
    --output-dir out/universal_model_chinext \
    --device cuda

# è®­ç»ƒç§‘åˆ›æ¿æ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ç§‘åˆ›æ¿ \
    --output-dir out/universal_model_star \
    --device cuda
```

**ä¼˜åŠ¿ï¼š**
- æ¯ä¸ªæ¿å—æœ‰ä¸“å±æ¨¡å‹
- å¯èƒ½æ›´ç²¾å‡†
- å¯ä»¥é’ˆå¯¹æ€§ä¼˜åŒ–

### åœºæ™¯3ï¼šå¿«é€Ÿæµ‹è¯•

```bash
# ç”¨ç§‘åˆ›æ¿å¿«é€Ÿæµ‹è¯•ï¼ˆæ•°é‡å°‘ï¼Œè®­ç»ƒå¿«ï¼‰
python scripts/train_universal_model.py \
    --stock-type ç§‘åˆ›æ¿ \
    --epochs 20 \
    --device cuda
```

**ä¼˜åŠ¿ï¼š**
- è‚¡ç¥¨æ•°é‡å°‘ï¼ˆ~500åªï¼‰
- è®­ç»ƒå¿«é€Ÿï¼ˆ10-20åˆ†é’Ÿï¼‰
- é€‚åˆæµ‹è¯•å’Œè°ƒè¯•

---

## ğŸ’¡ æ€§èƒ½å¯¹æ¯”

### æ•°æ®é¢„çƒ­æ—¶é—´

| è‚¡ç¥¨ç±»å‹ | æ•°é‡ | 8è¿›ç¨‹ | è¯´æ˜ |
|---------|------|-------|------|
| ç§‘åˆ›æ¿ | ~500åª | 15åˆ†é’Ÿ | æœ€å¿« |
| åˆ›ä¸šæ¿ | ~1200åª | 40åˆ†é’Ÿ | è¾ƒå¿« |
| ä¸»æ¿ | ~3000åª | 1.5å°æ—¶ | é€‚ä¸­ |
| å…¨éƒ¨ | ~5000åª | 2.5å°æ—¶ | æœ€æ…¢ |

### é€šç”¨æ¨¡å‹è®­ç»ƒæ—¶é—´ï¼ˆGPUï¼‰

| è‚¡ç¥¨ç±»å‹ | æ•°é‡ | è®­ç»ƒæ—¶é—´ | è¯´æ˜ |
|---------|------|---------|------|
| ç§‘åˆ›æ¿ | ~500åª | 10åˆ†é’Ÿ | æœ€å¿« |
| åˆ›ä¸šæ¿ | ~1200åª | 25åˆ†é’Ÿ | è¾ƒå¿« |
| ä¸»æ¿ | ~3000åª | 1å°æ—¶ | é€‚ä¸­ |
| å…¨éƒ¨ | ~5000åª | 1.5å°æ—¶ | æœ€æ…¢ |

---

## ğŸ” æŸ¥çœ‹è‚¡ç¥¨ç±»å‹åˆ†å¸ƒ

åˆ›å»ºæŸ¥è¯¢è„šæœ¬ `check_stock_types.py`ï¼š

```python
"""æŸ¥çœ‹è‚¡ç¥¨ç±»å‹åˆ†å¸ƒ"""
from src.data.loader import StockDataLoader

loader = StockDataLoader()

# æŸ¥è¯¢å„ç±»å‹è‚¡ç¥¨æ•°é‡
stock_types = ['ä¸»æ¿', 'åˆ›ä¸šæ¿', 'ç§‘åˆ›æ¿', 'ä¸­å°æ¿', 'åŒ—äº¤æ‰€']

print("è‚¡ç¥¨ç±»å‹åˆ†å¸ƒ:")
print("=" * 50)

total = 0
for stock_type in stock_types:
    symbols = loader.get_all_active_stocks(stock_type=stock_type)
    count = len(symbols)
    total += count
    print(f"{stock_type:8s}: {count:4d} åª")

print("=" * 50)
print(f"{'æ€»è®¡':8s}: {total:4d} åª")

# æŸ¥çœ‹æ‰€æœ‰è‚¡ç¥¨
all_symbols = loader.get_all_active_stocks()
print(f"{'å…¨éƒ¨':8s}: {len(all_symbols):4d} åª")
```

è¿è¡Œï¼š
```bash
python check_stock_types.py
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
è‚¡ç¥¨ç±»å‹åˆ†å¸ƒ:
==================================================
ä¸»æ¿      : 2856 åª
åˆ›ä¸šæ¿    : 1234 åª
ç§‘åˆ›æ¿    :  567 åª
ä¸­å°æ¿    :    0 åª
åŒ—äº¤æ‰€    :   89 åª
==================================================
æ€»è®¡      : 4746 åª
å…¨éƒ¨      : 4746 åª
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šåªè®­ç»ƒä¸»æ¿è‚¡ç¥¨ï¼ˆæ¨èï¼‰

```bash
# å®Œæ•´æµç¨‹
# 1. æ•°æ®é¢„çƒ­ï¼ˆçº¦1.5å°æ—¶ï¼‰
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# 2. è®­ç»ƒé€šç”¨æ¨¡å‹ï¼ˆçº¦1å°æ—¶ï¼ŒGPUï¼‰
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --epochs 50 \
    --batch-size 128 \
    --device cuda

# æ€»è€—æ—¶ï¼šçº¦2.5å°æ—¶
```

### ç¤ºä¾‹2ï¼šåˆ†æ¿å—è®­ç»ƒ

```bash
# ä¸»æ¿
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --output-dir out/model_mainboard --device cuda

# åˆ›ä¸šæ¿
python scripts/prepare_training_data.py --symbols all --stock-type åˆ›ä¸šæ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type åˆ›ä¸šæ¿ --output-dir out/model_chinext --device cuda

# ç§‘åˆ›æ¿
python scripts/prepare_training_data.py --symbols all --stock-type ç§‘åˆ›æ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type ç§‘åˆ›æ¿ --output-dir out/model_star --device cuda
```

### ç¤ºä¾‹3ï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆç§‘åˆ›æ¿ï¼‰

```bash
# å¿«é€Ÿæµ‹è¯•æµç¨‹ï¼ˆçº¦30åˆ†é’Ÿï¼‰
python scripts/prepare_training_data.py --symbols all --stock-type ç§‘åˆ›æ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type ç§‘åˆ›æ¿ --epochs 20 --device cuda
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç”Ÿäº§ç¯å¢ƒ

**æ¨èï¼šåªè®­ç»ƒä¸»æ¿è‚¡ç¥¨**

```bash
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --device cuda
```

**ç†ç”±ï¼š**
- ä¸»æ¿è‚¡ç¥¨æ›´ç¨³å®š
- æ•°æ®è´¨é‡æ›´å¥½
- æ•°é‡é€‚ä¸­ï¼ˆ~3000åªï¼‰
- è®­ç»ƒæ—¶é—´åˆç†

### 2. ç ”ç©¶å®éªŒ

**æ¨èï¼šåˆ†æ¿å—è®­ç»ƒå¤šä¸ªæ¨¡å‹**

```bash
# ä¸ºæ¯ä¸ªæ¿å—è®­ç»ƒä¸“å±æ¨¡å‹
for stock_type in ä¸»æ¿ åˆ›ä¸šæ¿ ç§‘åˆ›æ¿; do
    python scripts/train_universal_model.py \
        --stock-type $stock_type \
        --output-dir out/model_$stock_type \
        --device cuda
done
```

**ç†ç”±ï¼š**
- å¯ä»¥å¯¹æ¯”ä¸åŒæ¿å—çš„ç‰¹æ€§
- æ›´ç²¾å‡†çš„é¢„æµ‹
- é€‚åˆæ·±å…¥ç ”ç©¶

### 3. å¿«é€Ÿè¿­ä»£

**æ¨èï¼šä½¿ç”¨ç§‘åˆ›æ¿æµ‹è¯•**

```bash
python scripts/train_universal_model.py --stock-type ç§‘åˆ›æ¿ --epochs 20 --device cuda
```

**ç†ç”±ï¼š**
- æ•°é‡å°‘ï¼ˆ~500åªï¼‰
- è®­ç»ƒå¿«ï¼ˆ10-20åˆ†é’Ÿï¼‰
- é€‚åˆå¿«é€ŸéªŒè¯æƒ³æ³•

---

## ğŸ”§ æ•…éšœæ’é™¤

### Q1: å¦‚ä½•çŸ¥é“æœ‰å“ªäº›è‚¡ç¥¨ç±»å‹ï¼Ÿ

**ç­”ï¼š**
è¿è¡ŒæŸ¥è¯¢è„šæœ¬æŸ¥çœ‹ï¼š
```bash
python check_stock_types.py
```

æˆ–ç›´æ¥æŸ¥è¯¢æ•°æ®åº“ï¼š
```sql
SELECT DISTINCT stock_type, COUNT(*) as count
FROM stock_basic_info
WHERE is_active = 1
GROUP BY stock_type;
```

### Q2: æŒ‡å®šçš„è‚¡ç¥¨ç±»å‹æ²¡æœ‰æ•°æ®ï¼Ÿ

**ç­”ï¼š**
æ£€æŸ¥æ•°æ®åº“ä¸­è¯¥ç±»å‹çš„è‚¡ç¥¨æ•°é‡ï¼š
```python
from src.data.loader import StockDataLoader
loader = StockDataLoader()
symbols = loader.get_all_active_stocks(stock_type='ä¸»æ¿')
print(f"ä¸»æ¿è‚¡ç¥¨æ•°é‡: {len(symbols)}")
```

### Q3: å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç±»å‹å—ï¼Ÿ

**ç­”ï¼š**
å½“å‰ä¸æ”¯æŒï¼Œä½†å¯ä»¥åˆ†åˆ«è®­ç»ƒï¼š
```bash
# åˆ†åˆ«è®­ç»ƒ
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --output-dir out/model_mainboard
python scripts/train_universal_model.py --stock-type åˆ›ä¸šæ¿ --output-dir out/model_chinext
```

---

## ğŸ“Š æ€»ç»“

### æ–°å¢å‚æ•°

æ‰€æœ‰è®­ç»ƒè„šæœ¬éƒ½æ”¯æŒ `--stock-type` å‚æ•°ï¼š

```bash
# æ•°æ®é¢„çƒ­
python scripts/prepare_training_data.py --stock-type ä¸»æ¿

# é€šç”¨æ¨¡å‹è®­ç»ƒ
python scripts/train_universal_model.py --stock-type ä¸»æ¿

# æ‰¹é‡è®­ç»ƒ
python scripts/batch_train_all_stocks.py --stock-type ä¸»æ¿
```

### æ¨èä½¿ç”¨

**ç”Ÿäº§ç¯å¢ƒï¼š** åªè®­ç»ƒä¸»æ¿è‚¡ç¥¨
```bash
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --device cuda
```

**å¿«é€Ÿæµ‹è¯•ï¼š** ä½¿ç”¨ç§‘åˆ›æ¿
```bash
python scripts/train_universal_model.py --stock-type ç§‘åˆ›æ¿ --epochs 20 --device cuda
```

ç°åœ¨ä½ å¯ä»¥æŒ‰è‚¡ç¥¨ç±»å‹ç­›é€‰è®­ç»ƒäº†ï¼ğŸ¯
