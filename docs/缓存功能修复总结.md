# ç¼“å­˜åŠŸèƒ½ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è®­ç»ƒé€šç”¨æ¨¡å‹ï¼š

```bash
python scripts/train_universal_model.py \
    --model-type transformer \
    --epochs 100 \
    --batch-size 256 \
    --hidden-size 256 \
    --device cuda
```

**é—®é¢˜ï¼š** è„šæœ¬ä»MySQLæ•°æ®åº“åŠ è½½æ•°æ®ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `data/` ç›®å½•ä¸‹çš„ç¼“å­˜æ•°æ®ï¼Œå¯¼è‡´è®­ç»ƒé€Ÿåº¦éå¸¸æ…¢ã€‚

---

## ğŸ” æ ¹æœ¬åŸå› 

è™½ç„¶ `train_universal_model.py` è„šæœ¬å·²ç»å®ç°äº†ç¼“å­˜åŠŸèƒ½ï¼Œä½†å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **å‚æ•°å¤„ç†é€»è¾‘æ··ä¹±**
   ```python
   # åŸä»£ç 
   parser.add_argument("--use-cache", action="store_true", default=True, ...)
   parser.add_argument("--no-cache", action="store_true", ...)
   use_cache = not args.no_cache if args.no_cache else args.use_cache
   ```
   - `action="store_true"` ä¸ `default=True` å†²çª
   - é€»è¾‘å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™

2. **ç¼ºå°‘æ˜ç¡®æç¤º**
   - ç”¨æˆ·ä¸çŸ¥é“è„šæœ¬æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜
   - æ²¡æœ‰æ˜¾ç¤ºç¼“å­˜å‘½ä¸­ç‡

3. **æ–‡æ¡£ä¸æ¸…æ™°**
   - æ–‡æ¡£æ²¡æœ‰å¼ºè°ƒç¼“å­˜æ˜¯é»˜è®¤å¯ç”¨çš„
   - æ²¡æœ‰è¯´æ˜å¦‚ä½•ç¡®è®¤ä½¿ç”¨äº†ç¼“å­˜

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ç®€åŒ–å‚æ•°å¤„ç†é€»è¾‘

**ä¿®æ”¹å‰ï¼š**
```python
parser.add_argument("--use-cache", action="store_true", default=True, ...)
parser.add_argument("--no-cache", action="store_true", ...)
use_cache = not args.no_cache if args.no_cache else args.use_cache
```

**ä¿®æ”¹åï¼š**
```python
parser.add_argument("--no-cache", action="store_true", help="ä¸ä½¿ç”¨ç¼“å­˜ï¼Œä»æ•°æ®åº“åŠ è½½")
# é»˜è®¤ä½¿ç”¨ç¼“å­˜ï¼Œé™¤éæŒ‡å®š --no-cache
use_cache = not args.no_cache
```

**ä¼˜åŠ¿ï¼š**
- é€»è¾‘æ¸…æ™°ï¼šé»˜è®¤ `use_cache=True`
- åªéœ€ä¸€ä¸ªå‚æ•°ï¼š`--no-cache`
- ç¬¦åˆç›´è§‰ï¼šä¸åŠ å‚æ•°å°±ç”¨ç¼“å­˜

### 2. å¢åŠ æ˜ç¡®æç¤º

**ä¿®æ”¹å‰ï¼š**
```python
print(f"  è®¾å¤‡: {args.device}")
```

**ä¿®æ”¹åï¼š**
```python
print(f"  è®¾å¤‡: {args.device}")
print(f"  æ•°æ®æº: {'ç¼“å­˜æ•°æ®' if use_cache else 'MySQLæ•°æ®åº“'}")
if use_cache:
    print(f"    Kçº¿ç¼“å­˜: {args.kline_cache_dir}")
    print(f"    ç‰¹å¾ç¼“å­˜: {args.feature_cache_dir}")
```

**æ•ˆæœï¼š**
```
é…ç½®:
  æ¨¡å‹ç±»å‹: transformer
  ...
  è®¾å¤‡: cuda
  æ•°æ®æº: ç¼“å­˜æ•°æ®          â† æ˜ç¡®æ˜¾ç¤ºä½¿ç”¨ç¼“å­˜
    Kçº¿ç¼“å­˜: data/parquet
    ç‰¹å¾ç¼“å­˜: data/features
```

### 3. æ›´æ–°æ–‡æ¡£

åˆ›å»ºäº†ä»¥ä¸‹æ–‡æ¡£ï¼š

1. **docs/ç¼“å­˜æ•°æ®ä½¿ç”¨è¯´æ˜.md**
   - è¯¦ç»†è¯´æ˜ç¼“å­˜çš„ä½¿ç”¨æ–¹æ³•
   - æ€§èƒ½å¯¹æ¯”æ•°æ®
   - å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

2. **æ›´æ–° docs/é€šç”¨æ¨¡å‹å¿«é€Ÿå¼€å§‹.md**
   - å¼ºè°ƒç¼“å­˜æ˜¯é»˜è®¤å¯ç”¨çš„
   - æ·»åŠ æ•°æ®æºæ§åˆ¶è¯´æ˜
   - æ›´æ–°è¾“å‡ºç¤ºä¾‹

3. **test_cache_usage.py**
   - æµ‹è¯•è„šæœ¬ï¼ŒéªŒè¯ç¼“å­˜åŠŸèƒ½
   - æ£€æŸ¥ç¼“å­˜ç›®å½•å’Œæ–‡ä»¶
   - æµ‹è¯•ç¼“å­˜åŠ è½½

---

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä½¿ç”¨ä½“éªŒæ”¹è¿›

**ä¿®æ”¹å‰ï¼š**
```bash
# ç”¨æˆ·ä¸çŸ¥é“æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜
python scripts/train_universal_model.py --model-type transformer
# è¾“å‡ºä¸­æ²¡æœ‰æ˜ç¡®æç¤º
```

**ä¿®æ”¹åï¼š**
```bash
# é»˜è®¤ä½¿ç”¨ç¼“å­˜ï¼Œæœ‰æ˜ç¡®æç¤º
python scripts/train_universal_model.py --model-type transformer

# è¾“å‡ºï¼š
é…ç½®:
  ...
  æ•°æ®æº: ç¼“å­˜æ•°æ®          â† æ˜ç¡®æç¤º
    Kçº¿ç¼“å­˜: data/parquet
    ç‰¹å¾ç¼“å­˜: data/features

ä½¿ç”¨ç¼“å­˜æ•°æ®åŠ è½½ 5000 åªè‚¡ç¥¨...  â† æ˜ç¡®æç¤º
[100/5000] å·²åŠ è½½ 98 åª (ç¼“å­˜å‘½ä¸­: 95, æœªå‘½ä¸­: 3)  â† ç¼“å­˜å‘½ä¸­ç‡
```

### æ€§èƒ½æå‡

| åœºæ™¯ | ä¿®å¤å‰ | ä¿®å¤å | æå‡ |
|------|--------|--------|------|
| æ•°æ®åŠ è½½ | 2-3å°æ—¶ | 2-5åˆ†é’Ÿ | 30-100x |
| å®Œæ•´è®­ç»ƒ | 5-8å°æ—¶ | 2-5å°æ—¶ | 2x |

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### æ­£ç¡®çš„è®­ç»ƒæµç¨‹

#### ç¬¬1æ­¥ï¼šæ•°æ®é¢„çƒ­ï¼ˆå¿…é¡»ï¼ï¼‰

```bash
# é¢„çƒ­å…¨å¸‚åœºæ•°æ®åˆ°ç¼“å­˜
python scripts/prepare_training_data.py --symbols all --workers 8 --resume
```

**è¾“å‡ºï¼š**
- Kçº¿ç¼“å­˜ï¼š`data/parquet/*.parquet`
- ç‰¹å¾ç¼“å­˜ï¼š`data/features/*_features.parquet`

#### ç¬¬2æ­¥ï¼šè®­ç»ƒæ¨¡å‹ï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼‰

```bash
# é»˜è®¤ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œæ— éœ€é¢å¤–å‚æ•°
python scripts/train_universal_model.py \
    --model-type transformer \
    --epochs 100 \
    --batch-size 256 \
    --hidden-size 256 \
    --device cuda
```

**âœ… å…³é”®ç‚¹ï¼š**
- æ— éœ€æ·»åŠ  `--use-cache` å‚æ•°
- è„šæœ¬é»˜è®¤ä½¿ç”¨ç¼“å­˜æ•°æ®
- è¾“å‡ºä¼šæ˜ç¡®æ˜¾ç¤ºä½¿ç”¨äº†ç¼“å­˜

### æ•°æ®æºæ§åˆ¶

```bash
# é»˜è®¤ï¼šä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆæ¨èï¼‰
python scripts/train_universal_model.py

# å¼ºåˆ¶ä»MySQLæ•°æ®åº“åŠ è½½ï¼ˆä¸æ¨èï¼Œéå¸¸æ…¢ï¼‰
python scripts/train_universal_model.py --no-cache

# æŒ‡å®šè‡ªå®šä¹‰ç¼“å­˜ç›®å½•
python scripts/train_universal_model.py \
    --kline-cache-dir /path/to/kline/cache \
    --feature-cache-dir /path/to/feature/cache
```

### å¦‚ä½•ç¡®è®¤ä½¿ç”¨äº†ç¼“å­˜ï¼Ÿ

#### æ–¹æ³•1ï¼šæŸ¥çœ‹è¾“å‡ºæ—¥å¿—

```
é…ç½®:
  ...
  æ•°æ®æº: ç¼“å­˜æ•°æ®          â† ç¡®è®¤ä½¿ç”¨ç¼“å­˜
    Kçº¿ç¼“å­˜: data/parquet
    ç‰¹å¾ç¼“å­˜: data/features

ä½¿ç”¨ç¼“å­˜æ•°æ®åŠ è½½ 5000 åªè‚¡ç¥¨...  â† ç¡®è®¤ä½¿ç”¨ç¼“å­˜
[100/5000] å·²åŠ è½½ 98 åª (ç¼“å­˜å‘½ä¸­: 95, æœªå‘½ä¸­: 3)  â† ç¼“å­˜å‘½ä¸­ç‡
```

#### æ–¹æ³•2ï¼šè§‚å¯ŸåŠ è½½é€Ÿåº¦

| ç°è±¡ | æ•°æ®æº |
|------|--------|
| 5000åªè‚¡ç¥¨åŠ è½½2-5åˆ†é’Ÿ | âœ… ç¼“å­˜æ•°æ® |
| 5000åªè‚¡ç¥¨åŠ è½½2-3å°æ—¶ | âŒ MySQLæ•°æ®åº“ |

#### æ–¹æ³•3ï¼šè¿è¡Œæµ‹è¯•è„šæœ¬

```bash
python test_cache_usage.py
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 1. æ ¸å¿ƒä»£ç ä¿®æ”¹

**scripts/train_universal_model.py**
- ç®€åŒ–ç¼“å­˜å‚æ•°å¤„ç†é€»è¾‘
- æ·»åŠ æ•°æ®æºæ˜ç¡®æç¤º
- ç§»é™¤ `--use-cache` å‚æ•°ï¼Œåªä¿ç•™ `--no-cache`

### 2. æ–°å¢æ–‡æ¡£

**docs/ç¼“å­˜æ•°æ®ä½¿ç”¨è¯´æ˜.md**
- ç¼“å­˜ä½¿ç”¨çš„å®Œæ•´æŒ‡å—
- æ€§èƒ½å¯¹æ¯”æ•°æ®
- å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ
- æœ€ä½³å®è·µ

**docs/ç¼“å­˜åŠŸèƒ½ä¿®å¤æ€»ç»“.md**ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- é—®é¢˜æè¿°å’Œæ ¹æœ¬åŸå› 
- ä¿®å¤æ–¹æ¡ˆå’Œæ•ˆæœ
- ä½¿ç”¨æŒ‡å—

### 3. æ›´æ–°æ–‡æ¡£

**docs/é€šç”¨æ¨¡å‹å¿«é€Ÿå¼€å§‹.md**
- å¼ºè°ƒç¼“å­˜æ˜¯é»˜è®¤å¯ç”¨çš„
- æ·»åŠ æ•°æ®æºæ§åˆ¶è¯´æ˜
- æ›´æ–°è¾“å‡ºç¤ºä¾‹ï¼Œæ˜¾ç¤ºç¼“å­˜ä¿¡æ¯

### 4. æµ‹è¯•è„šæœ¬

**test_cache_usage.py**
- æ£€æŸ¥ç¼“å­˜ç›®å½•å’Œæ–‡ä»¶
- æµ‹è¯•ç¼“å­˜åŠ è½½åŠŸèƒ½
- éªŒè¯è®­ç»ƒè„šæœ¬é…ç½®

---

## ğŸ¯ æ€»ç»“

### æ ¸å¿ƒæ”¹è¿›

1. âœ… **ç®€åŒ–é€»è¾‘** - ç§»é™¤æ··ä¹±çš„å‚æ•°å¤„ç†ï¼Œé»˜è®¤ä½¿ç”¨ç¼“å­˜
2. âœ… **æ˜ç¡®æç¤º** - è¾“å‡ºä¸­æ˜ç¡®æ˜¾ç¤ºæ•°æ®æºå’Œç¼“å­˜å‘½ä¸­ç‡
3. âœ… **å®Œå–„æ–‡æ¡£** - è¯¦ç»†è¯´æ˜ç¼“å­˜ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µ
4. âœ… **æµ‹è¯•å·¥å…·** - æä¾›æµ‹è¯•è„šæœ¬éªŒè¯ç¼“å­˜åŠŸèƒ½

### ç”¨æˆ·ä½“éªŒ

**ä¿®å¤å‰ï¼š**
- âŒ ä¸çŸ¥é“æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜
- âŒ è®­ç»ƒé€Ÿåº¦æ…¢ï¼Œä¸çŸ¥é“åŸå› 
- âŒ éœ€è¦æ‰‹åŠ¨æ·»åŠ å‚æ•°

**ä¿®å¤åï¼š**
- âœ… æ˜ç¡®æ˜¾ç¤ºä½¿ç”¨äº†ç¼“å­˜
- âœ… è®­ç»ƒé€Ÿåº¦å¿«10-100å€
- âœ… é»˜è®¤é…ç½®å³å¯ï¼Œæ— éœ€é¢å¤–å‚æ•°

### å¿«é€Ÿå¼€å§‹

```bash
# 1. é¢„çƒ­æ•°æ®ï¼ˆå¿…é¡»ï¼ï¼‰
python scripts/prepare_training_data.py --symbols all --workers 8 --resume

# 2. è®­ç»ƒæ¨¡å‹ï¼ˆè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜ï¼‰
python scripts/train_universal_model.py --model-type transformer --device cuda

# 3. éªŒè¯ç¼“å­˜åŠŸèƒ½
python test_cache_usage.py
```

ç°åœ¨è®­ç»ƒè„šæœ¬ä¼šè‡ªåŠ¨ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œé€Ÿåº¦å¿«10-100å€ï¼ğŸš€
