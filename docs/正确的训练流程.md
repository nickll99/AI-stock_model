# æ­£ç¡®çš„è®­ç»ƒæµç¨‹

## âš ï¸ é‡è¦æç¤º

è®­ç»ƒå‰**å¿…é¡»**å…ˆé¢„çƒ­æ•°æ®ï¼ŒåŒ…æ‹¬Kçº¿æ•°æ®å’Œç‰¹å¾æ•°æ®ï¼

---

## ğŸ¯ å®Œæ•´æµç¨‹

### ç¬¬1æ­¥ï¼šé¢„çƒ­Kçº¿å’Œç‰¹å¾æ•°æ®ï¼ˆå¿…é¡»ï¼‰

```bash
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume
```

**è¿™ä¸€æ­¥ä¼šåšä»€ä¹ˆï¼š**
1. âœ… ä»æ•°æ®åº“åŠ è½½Kçº¿æ•°æ®
2. âœ… è®¡ç®—æŠ€æœ¯æŒ‡æ ‡ï¼ˆMAã€EMAã€MACDã€RSIç­‰ï¼‰
3. âœ… ä¿å­˜Kçº¿ç¼“å­˜åˆ° `data/parquet/`
4. âœ… ä¿å­˜ç‰¹å¾ç¼“å­˜åˆ° `data/features/`

**é¢„è®¡æ—¶é—´ï¼š**
- ä¸»æ¿ï¼ˆ~3000åªï¼‰ï¼š1.5-2å°æ—¶
- å…¨éƒ¨ï¼ˆ~5000åªï¼‰ï¼š2.5-3å°æ—¶

### ç¬¬2æ­¥ï¼šè®­ç»ƒæ¨¡å‹ï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰

```bash
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

**è¿™ä¸€æ­¥ä¼šåšä»€ä¹ˆï¼š**
1. âœ… ä» `data/features/` åŠ è½½å·²è®¡ç®—å¥½çš„ç‰¹å¾ï¼ˆç§’çº§ï¼‰
2. âœ… ç›´æ¥è®­ç»ƒæ¨¡å‹ï¼ˆæ— éœ€é‡æ–°è®¡ç®—ç‰¹å¾ï¼‰

**é¢„è®¡æ—¶é—´ï¼š**
- ä¸»æ¿ï¼ˆ~3000åªï¼‰ï¼š1å°æ—¶ï¼ˆGPUï¼‰
- å…¨éƒ¨ï¼ˆ~5000åªï¼‰ï¼š1.5å°æ—¶ï¼ˆGPUï¼‰

---

## âŒ é”™è¯¯çš„æµç¨‹

### é”™è¯¯1ï¼šæ²¡æœ‰é¢„çƒ­å°±ç›´æ¥è®­ç»ƒ

```bash
# âŒ é”™è¯¯ï¼šç›´æ¥è®­ç»ƒ
python scripts/train_universal_model.py --stock-type ä¸»æ¿
```

**é—®é¢˜ï¼š**
- ä¼šä»æ•°æ®åº“å®æ—¶åŠ è½½æ•°æ®
- ä¼šå®æ—¶è®¡ç®—ç‰¹å¾ï¼ˆéå¸¸æ…¢ï¼‰
- 3000åªè‚¡ç¥¨å¯èƒ½éœ€è¦10+å°æ—¶

### é”™è¯¯2ï¼šåªé¢„çƒ­Kçº¿ï¼Œæ²¡æœ‰é¢„çƒ­ç‰¹å¾

```bash
# âŒ é”™è¯¯ï¼šåªé¢„çƒ­Kçº¿
python scripts/prepare_training_data.py --symbols all --kline-only

# ç„¶åè®­ç»ƒ
python scripts/train_universal_model.py
```

**é—®é¢˜ï¼š**
- è™½ç„¶Kçº¿æœ‰ç¼“å­˜
- ä½†ç‰¹å¾éœ€è¦å®æ—¶è®¡ç®—ï¼ˆå¾ˆæ…¢ï¼‰
- ä»ç„¶éœ€è¦å¾ˆé•¿æ—¶é—´

---

## âœ… æ­£ç¡®çš„æµç¨‹

### æ–¹æ¡ˆ1ï¼šå®Œæ•´é¢„çƒ­ï¼ˆæ¨èï¼‰

```bash
# ç¬¬1æ­¥ï¼šé¢„çƒ­æ‰€æœ‰æ•°æ®ï¼ˆKçº¿ + ç‰¹å¾ï¼‰
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# ç¬¬2æ­¥ï¼šè®­ç»ƒæ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

### æ–¹æ¡ˆ2ï¼šåˆ†é˜¶æ®µé¢„çƒ­

```bash
# ç¬¬1æ­¥ï¼šé¢„çƒ­Kçº¿æ•°æ®
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --kline-only \
    --workers 8 \
    --resume

# ç¬¬2æ­¥ï¼šé¢„çƒ­ç‰¹å¾æ•°æ®
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --features-only \
    --workers 4 \
    --resume

# ç¬¬3æ­¥ï¼šè®­ç»ƒæ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ²¡æœ‰é¢„çƒ­ vs æœ‰é¢„çƒ­

| æ­¥éª¤ | æ²¡æœ‰é¢„çƒ­ | æœ‰é¢„çƒ­ | æå‡ |
|------|---------|--------|------|
| æ•°æ®åŠ è½½ | 10å°æ—¶ | 10åˆ†é’Ÿ | 60x |
| ç‰¹å¾è®¡ç®— | åŒ…å«åœ¨ä¸Šé¢ | å·²å®Œæˆ | - |
| æ¨¡å‹è®­ç»ƒ | 1å°æ—¶ | 1å°æ—¶ | - |
| **æ€»è®¡** | **11å°æ—¶** | **1å°æ—¶** | **11x** |

### é¢„çƒ­æ—¶é—´åˆ†è§£

| ä»»åŠ¡ | ä¸»æ¿ï¼ˆ3000åªï¼‰ | å…¨éƒ¨ï¼ˆ5000åªï¼‰ |
|------|---------------|---------------|
| Kçº¿é¢„çƒ­ | 1å°æ—¶ | 1.5å°æ—¶ |
| ç‰¹å¾é¢„çƒ­ | 0.5å°æ—¶ | 1å°æ—¶ |
| **æ€»è®¡** | **1.5å°æ—¶** | **2.5å°æ—¶** |

---

## ğŸ” å¦‚ä½•æ£€æŸ¥ç¼“å­˜çŠ¶æ€

### æ£€æŸ¥Kçº¿ç¼“å­˜

```bash
# æŸ¥çœ‹Kçº¿ç¼“å­˜æ–‡ä»¶
ls -lh data/parquet/*.parquet | wc -l

# æŸ¥çœ‹ç¼“å­˜å¤§å°
du -sh data/parquet/
```

### æ£€æŸ¥ç‰¹å¾ç¼“å­˜

```bash
# æŸ¥çœ‹ç‰¹å¾ç¼“å­˜æ–‡ä»¶
ls -lh data/features/*_features.parquet | wc -l

# æŸ¥çœ‹ç¼“å­˜å¤§å°
du -sh data/features/
```

### æ£€æŸ¥ç‰¹å®šè‚¡ç¥¨çš„ç¼“å­˜

```python
from src.data.cached_loader import ParquetDataLoader, FeatureCache

# æ£€æŸ¥Kçº¿ç¼“å­˜
kline_loader = ParquetDataLoader(cache_dir="data/parquet")
df = kline_loader.load_kline_data("000001", "2021-01-01", "2024-12-31", use_cache=True)
print(f"Kçº¿æ•°æ®: {len(df)} æ¡")

# æ£€æŸ¥ç‰¹å¾ç¼“å­˜
feature_cache = FeatureCache(cache_dir="data/features")
df_features = feature_cache.load_features("000001")
if df_features is not None:
    print(f"ç‰¹å¾æ•°æ®: {len(df_features)} æ¡, {df_features.shape[1]} ä¸ªç‰¹å¾")
else:
    print("ç‰¹å¾ç¼“å­˜ä¸å­˜åœ¨")
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆè®­ç»ƒå¾ˆæ…¢ï¼Ÿ

**ç­”ï¼š**
æ£€æŸ¥æ˜¯å¦é¢„çƒ­äº†ç‰¹å¾æ•°æ®ï¼š

```bash
# æ£€æŸ¥ç‰¹å¾ç¼“å­˜
ls data/features/*.parquet | wc -l
```

å¦‚æœæ•°é‡ä¸º0æˆ–å¾ˆå°‘ï¼Œè¯´æ˜æ²¡æœ‰é¢„çƒ­ç‰¹å¾ï¼Œéœ€è¦è¿è¡Œï¼š

```bash
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume
```

### Q2: å¦‚ä½•çŸ¥é“æ˜¯å¦ä½¿ç”¨äº†ç¼“å­˜ï¼Ÿ

**ç­”ï¼š**
æŸ¥çœ‹è®­ç»ƒè¾“å‡ºï¼š

```
ä½¿ç”¨ç¼“å­˜æ•°æ®åŠ è½½ 3000 åªè‚¡ç¥¨...
  Kçº¿ç¼“å­˜: data/parquet
  ç‰¹å¾ç¼“å­˜: data/features

æ•°æ®åŠ è½½å®Œæˆ:
  æˆåŠŸ: 2850 åª
  å¤±è´¥: 150 åª
  ç¼“å­˜å‘½ä¸­: 2850 åª (100.0%)  â† è¿™é‡Œï¼
  ç¼“å­˜æœªå‘½ä¸­: 0 åª
```

å¦‚æœ"ç¼“å­˜å‘½ä¸­"æ¥è¿‘100%ï¼Œè¯´æ˜ä½¿ç”¨äº†ç¼“å­˜ã€‚

### Q3: ç¼“å­˜åœ¨å“ªé‡Œï¼Ÿ

**ç­”ï¼š**
```
data/
â”œâ”€â”€ parquet/           # Kçº¿ç¼“å­˜
â”‚   â”œâ”€â”€ 000001.parquet
â”‚   â”œâ”€â”€ 000002.parquet
â”‚   â””â”€â”€ ...
â””â”€â”€ features/          # ç‰¹å¾ç¼“å­˜
    â”œâ”€â”€ 000001_features.parquet
    â”œâ”€â”€ 000002_features.parquet
    â””â”€â”€ ...
```

### Q4: å¦‚ä½•æ¸…é™¤ç¼“å­˜é‡æ–°é¢„çƒ­ï¼Ÿ

**ç­”ï¼š**
```bash
# æ¸…é™¤æ‰€æœ‰ç¼“å­˜
rm -rf data/parquet/*
rm -rf data/features/*

# é‡æ–°é¢„çƒ­
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume
```

### Q5: é¢„çƒ­åç¼“å­˜ä¼šè¿‡æœŸå—ï¼Ÿ

**ç­”ï¼š**
ä¸ä¼šè‡ªåŠ¨è¿‡æœŸï¼Œä½†å»ºè®®ï¼š
- æ¯å‘¨é‡æ–°é¢„çƒ­ä¸€æ¬¡ï¼ˆè·å–æœ€æ–°æ•°æ®ï¼‰
- æˆ–è€…åªé¢„çƒ­æœ€è¿‘çš„æ•°æ®

```bash
# åªé¢„çƒ­æœ€è¿‘30å¤©çš„æ•°æ®
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --start-date $(date -d "30 days ago" +%Y-%m-%d) \
    --workers 8 \
    --resume
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. é¦–æ¬¡ä½¿ç”¨

```bash
# ç¬¬1æ­¥ï¼šé¢„çƒ­æ•°æ®ï¼ˆä¸€æ¬¡æ€§ï¼Œ1.5-2å°æ—¶ï¼‰
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# ç¬¬2æ­¥ï¼šè®­ç»ƒæ¨¡å‹ï¼ˆå¯ä»¥å¤šæ¬¡è¿è¡Œï¼Œæ¯æ¬¡1å°æ—¶ï¼‰
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

### 2. æ—¥å¸¸ä½¿ç”¨

```bash
# ç›´æ¥è®­ç»ƒï¼ˆä½¿ç”¨å·²æœ‰ç¼“å­˜ï¼‰
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

### 3. å®šæœŸæ›´æ–°

```bash
# æ¯å‘¨é‡æ–°é¢„çƒ­ä¸€æ¬¡
# crontab: 0 2 * * 0 /path/to/update.sh

#!/bin/bash
# update.sh

# é‡æ–°é¢„çƒ­æ•°æ®
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# é‡æ–°è®­ç»ƒæ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda
```

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šä»é›¶å¼€å§‹ï¼ˆé¦–æ¬¡ä½¿ç”¨ï¼‰

```bash
# 1. æ£€æŸ¥GPU
python scripts/check_gpu.py

# 2. æŸ¥çœ‹è‚¡ç¥¨ç±»å‹
python scripts/check_stock_types.py

# 3. é¢„çƒ­ä¸»æ¿è‚¡ç¥¨æ•°æ®
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ä¸»æ¿ \
    --workers 8 \
    --resume

# 4. æ£€æŸ¥ç¼“å­˜
ls data/parquet/*.parquet | wc -l
ls data/features/*.parquet | wc -l

# 5. è®­ç»ƒæ¨¡å‹
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --device cuda

# æ€»è€—æ—¶ï¼šçº¦2.5-3å°æ—¶
```

### ç¤ºä¾‹2ï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆç§‘åˆ›æ¿ï¼‰

```bash
# 1. é¢„çƒ­ç§‘åˆ›æ¿æ•°æ®ï¼ˆ15åˆ†é’Ÿï¼‰
python scripts/prepare_training_data.py \
    --symbols all \
    --stock-type ç§‘åˆ›æ¿ \
    --workers 8 \
    --resume

# 2. è®­ç»ƒæ¨¡å‹ï¼ˆ10åˆ†é’Ÿï¼‰
python scripts/train_universal_model.py \
    --stock-type ç§‘åˆ›æ¿ \
    --epochs 20 \
    --device cuda

# æ€»è€—æ—¶ï¼šçº¦25åˆ†é’Ÿ
```

### ç¤ºä¾‹3ï¼šå·²æœ‰ç¼“å­˜ï¼Œé‡æ–°è®­ç»ƒ

```bash
# ç›´æ¥è®­ç»ƒï¼ˆ1å°æ—¶ï¼‰
python scripts/train_universal_model.py \
    --stock-type ä¸»æ¿ \
    --epochs 100 \
    --batch-size 256 \
    --device cuda
```

---

## ğŸ¯ æ€»ç»“

### å…³é”®ç‚¹

1. âœ… **å¿…é¡»å…ˆé¢„çƒ­æ•°æ®**ï¼ˆåŒ…æ‹¬Kçº¿å’Œç‰¹å¾ï¼‰
2. âœ… **é¢„çƒ­ä¸€æ¬¡ï¼Œå¤šæ¬¡ä½¿ç”¨**
3. âœ… **å®šæœŸæ›´æ–°ç¼“å­˜**ï¼ˆå»ºè®®æ¯å‘¨ï¼‰

### æ­£ç¡®æµç¨‹

```bash
# ä¸€æ¬¡é¢„çƒ­
python scripts/prepare_training_data.py --symbols all --stock-type ä¸»æ¿ --workers 8 --resume

# å¤šæ¬¡è®­ç»ƒ
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --device cuda
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --epochs 100 --device cuda
python scripts/train_universal_model.py --stock-type ä¸»æ¿ --batch-size 256 --device cuda
```

### æ€§èƒ½æå‡

- é¢„çƒ­åè®­ç»ƒé€Ÿåº¦æå‡ï¼š**10-60å€**
- é¢„çƒ­æ—¶é—´ï¼š1.5-2å°æ—¶ï¼ˆä¸€æ¬¡æ€§ï¼‰
- è®­ç»ƒæ—¶é—´ï¼š1å°æ—¶ï¼ˆå¯å¤šæ¬¡ï¼‰

ç°åœ¨ä½ çŸ¥é“æ­£ç¡®çš„è®­ç»ƒæµç¨‹äº†ï¼ğŸš€
